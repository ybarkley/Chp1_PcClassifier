---
title: "Aggregate Results"
author: "Yvonne Barkley"
date: "August 30, 2018"
output: html_notebook
---

Use aggregate function to complete various analyses of the test results.

```{r}
library(plyr)
library(reshape2)


today = 20190312
model = 'PMN'

#Import PcResults_TestResults csv for the classifier
agg_data <- read.csv('data/PcResults_TestResults_PMN_20181209.csv')

agg_data <- read.csv('data/PcResults_TestResults_PN_20181209.csv')

agg_data <- read.csv('data/PcResults_TestResults_PM_20181209.csv')

#1. How many times was each acoustic encounter represented in the test data?
AcEncs_Test <- aggregate(x = agg_data, 
                               by = list(unique.values = agg_data$EncounterID), 
                               FUN = length)


#2. Loop the subsetting to sum up things 
IDs <- unique(agg_data$EncounterID)
filtByEnc = NULL
filtCorrect = NULL
for (k in 1:length(IDs)){
  temp <- agg_data[agg_data$EncounterID==IDs[k], ]
  correct <- data.frame("EncounterID" = IDs[k], "x"=sum(temp$CorrectDW >= 75)) #change to 50 for PNM model, 60 for pairwise models
  filtCorrect = rbind(filtCorrect, correct)
  filtByEnc = rbind(filtByEnc, temp)
}
filtCorrect$EncounterID <-as.character(filtCorrect$EncounterID) 

filtCorrect <- filtCorrect[order(as.character(filtCorrect$EncounterID)),]

#What is the number of correctly classified encounters based on the number of times the acoustic encounter was included in the test data?
#Combine filtered correct data with tally of times ac enc was included in the test data
agg_data_sum <- cbind(filtCorrect, "y" = AcEncs_Test$rep)

#Divide columns to get proportional data and add that into a third column
#library(dplyr)
agg_data_sum <- mutate(agg_data_sum, new = x/y)

fn = sprintf("_%s_%s.csv", model, today)
write.csv(agg_data_sum, file= paste('PcResults_AggregatedTestResults', fn, sep=""), row.names = F )
write.csv(filtByEnc,'C:\\Users\\Yvonne\\OneDrive\\PHD\\CHP1-FKW\\data\\results\\2018\\PcResults_OrderedTestResults_PM_20180830.csv', row.names = F )


```



Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
