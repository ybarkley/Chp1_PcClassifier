
#Kruskal-Wallis Tests
```{r}
#pcdata.MN <- filter(pcdata, population == "mhi" | population == "nwhi")
pcdata.PM <- droplevels(filter(pcdata, population == "mhi" | population == "pel"))
pcdata.PN <- droplevels(filter(pcdata, population == "pel" | population == "nwhi"))


pcdata.P <- droplevels(filter(pcdata, population == "pel"))      
pcdata.N <- droplevels(filter(pcdata, population == "nwhi"))      
pcdata.M <- droplevels(filter(pcdata, population == "mhi"))

```


```{r}
#https://stackoverflow.com/questions/21271449/how-to-apply-the-wilcox-test-to-a-whole-dataframe-in-r
#This makes a list of all K-W test results for all variables
pckw <- apply(pcdata[-c(1:6,54:61)],2, kruskal.test,pcdata$population)

#Put column names of variables in a vector
names <- names(pcdata)[-c(1:6, 54:61)]

#I only want p-values < 0.05
b <- do.call(rbind, lapply(pckw, function(v){v$p.value})) #pull out only values from list (makes matrix)

b2 <-cbind(names, as.data.frame(b, row.names = T)) #create dataframe of pvalues from matrix
colnames(b2)<-c("variable", "p.value")  #success!

b2signif <- filter(b2, b2$p.value <= 0.05)

#For Pelagic and NWHI
pckw.PN <- apply(pcdata.PN[-c(1:6,54:61)],2, kruskal.test,pcdata.PN$population)
b.PN <- do.call(rbind, lapply(pckw.PN, function(v){v$p.value})) #pull out only values from list (makes matrix)
b2.PN <-cbind(names, as.data.frame(b.PN, row.names = T)) #create dataframe of pvalues from matrix
colnames(b2.PN)<-c("variable", "p.value")  #success!

b2signif.PN <- filter(b2.PN, b2.PN$p.value <= 0.05)
namesPN <- colnames(b2signif.PN)

#For Pelagic and MHI  
pckw.PM <- apply(pcdata.PM[-c(1:6,54:61)],2, kruskal.test,pcdata.PM$population)
b.PM <- do.call(rbind, lapply(pckw.PM, function(v){v$p.value})) #pull out only values from list (makes matrix)
b2.PM <-cbind(names, as.data.frame(b.PM, row.names = T)) #create dataframe of pvalues from matrix
colnames(b2.PM)<-c("variable", "p.value")  #success!

b2signif.PM <- filter(b2.PM, b2.PM$p.value <= 0.05)
namesPM <- colnames(b2signif.PM)





```

```{r}
#Create dataframes with only variables that match the significant variables from the KW tests

#vector of variable names
PNMvars <- b2signif[,1]
idx <- match(PNMvars, names(pcdata))  
newPNMdf <- cbind(pcdata[,c(1:6)], pcdata[, idx])

#For Pelagic and NWHI
PNvars <- b2signif[,1]
idx <- match(PNvars, names(pcdata.PN))  
newPNdf <- cbind(pcdata.PN[,c(1:6)], pcdata.PN[, idx])

#for Pelagic and MHI
PMvars <- b2signif[,1]
idx <- match(PMvars, names(pcdata.PM))  
newPMdf <- cbind(pcdata.PM[,c(1:6)], pcdata.PM[, idx])


write.csv(newPNMdf, 'C:\\Users\\Yvonne\\OneDrive\\PHD\\CHP1-FKW\\data\\2017- 100 New Whistles\\ROCCA Towed Data\\SIGNIF_PNM.csv', row.names = F)
write.csv(newPNdf, 'C:\\Users\\Yvonne\\OneDrive\\PHD\\CHP1-FKW\\data\\2017- 100 New Whistles\\ROCCA Towed Data\\SIGNIF_PN.csv', row.names = F)
write.csv(newPMdf, 'C:\\Users\\Yvonne\\OneDrive\\PHD\\CHP1-FKW\\data\\2017- 100 New Whistles\\ROCCA Towed Data\\SIGNIF_PM.csv', row.names = F)

```


#Kruskal Wallis tests for important variables - MHI population
```{r}
#MHI
pckw.M <- apply(pcdata.M[-c(1:6,54:61)],2, kruskal.test,pcdata.M$EncounterID)

b.M <- do.call(rbind, lapply(pckw.M, function(v){v$p.value})) #pull out only values from list (makes matrix)
b2.M <-cbind(names, as.data.frame(b.M, row.names = T)) #create dataframe of pvalues from matrix
colnames(b2.M)<-c("variable", "p.value")  #success!

b2signif.M <- filter(b2.M, b2.M$p.value <= 0.05)
namesM <- colnames(b2signif.M)


#Pelagic
pckw.P <- apply(pcdata.P[-c(1:6,54:61)],2, kruskal.test,pcdata.P$EncounterID)

b.P <- do.call(rbind, lapply(pckw.P, function(v){v$p.value})) #pull out only values from list (makes matrix)
b2.P <-cbind(names, as.data.frame(b.P, row.names = T)) #create dataframe of pvalues from matrix
colnames(b2.P)<-c("variable", "p.value")  #success!

b2signif.P <- filter(b2.P, b2.P$p.value <= 0.05)
namesP <- colnames(b2signif.P)


#NWHI
pckw.N <- apply(pcdata.N[-c(1:6,54:61)],2, kruskal.test,pcdata.N$EncounterID)

b.N <- do.call(rbind, lapply(pckw.N, function(v){v$p.value})) #pull out only p-values from list (makes matrix)
b2.N <-cbind(names, as.data.frame(b.N, row.names = T)) #create dataframe of all pvalues from matrix
colnames(b2.N)<-c("variable", "p.value")  #success!

b2signif.N <- filter(b2.N, b2.N$p.value <= 0.05)
namesN <- colnames(b2signif.N)



```

```{r}
#### FREQQUARTER3 ####

#MHI-NWHI-Pelagic
kruskal.test(FREQQUARTER3~population, pcdata)

#MHI-NWHI
kruskal.test(FREQQUARTER3~population, pcdata.MN)

#MHI-Pelagic
kruskal.test(FREQQUARTER3~population, pcdata.MP)

#Pelagic-NWHI
kruskal.test(FREQQUARTER3~population, pcdata.PN)
```


```{r}

```

```{r}


```

```{r}
#### DURATION ####

#MHI-NWHI-Pelagic
kruskal.test(population ~ DURATION, pcdata)

#MHI-NWHI
kruskal.test(population ~ DURATION, pcdata.MN)

#MHI-Pelagic
kruskal.test(population ~ DURATION, pcdata.MP)

#Pelagic-NWHI
kruskal.test(population ~ DURATION, pcdata.PN)
```